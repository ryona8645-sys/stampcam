<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>StampCam PWA</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#111111">
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>

  <!-- 上部固定ステータスバー -->
  <header class="statusBar">
    <div class="statusRow">
      <div class="statusItem">
        <span class="statusLabel">案件</span>
        <span id="stProject" class="statusVal">-</span>
      </div>
      <div class="statusItem">
        <span class="statusLabel">部屋</span>
        <span id="stRoom" class="statusVal">-</span>
      </div>
      <div class="statusItem">
        <span class="statusLabel">機器</span>
        <span id="stDevice" class="statusVal">-</span>
      </div>
    </div>
  </header>

  <main class="wrap">
    
    <!-- STEP 1: 準備 (案件・部屋追加) -->
    <section class="panel">
      <details>
        <summary class="panelSummary">
          <span class="stepNum">1</span> 案件・部屋登録
        </summary>
        <div class="panelContent">
          <div class="inputGroup">
            <label>案件名</label>
            <input id="projectName" placeholder="例: ○○ビル改修工事" />
          </div>
          <div class="inputGroup">
            <label>部屋を追加</label>
            <div class="row">
              <input id="floorName" placeholder="例: 1F MDF室" />
              <button id="btnAddRoom" class="primary">追加</button>
            </div>
          </div>
          <div class="actions row space" style="margin-top:10px; border-top:1px solid #333; padding-top:10px;">
             <span id="storageWarn" class="storageInfo">容量確認中...</span>
             <div class="row">
               <button id="btnExport">ZIP保存</button>
               <button id="btnWipe" class="danger">全削除</button>
             </div>
          </div>
        </div>
      </details>
    </section>

    <!-- STEP 2: 部屋選択 & 機器リスト -->
    <section class="panel">
      <div class="panelHeader">
        <span class="stepNum">2</span> 部屋リスト <span class="subText">（タップで選択）</span>
      </div>
      <div class="chkRow" style="justify-content: flex-end; margin-bottom: 8px;">
        <input type="checkbox" id="onlyIncomplete">
        <label for="onlyIncomplete">未完了のみ表示</label>
      </div>
      <div id="roomList" class="roomList"></div>
    </section>

    <!-- STEP 3: 機器追加 (選択中の部屋に対して) -->
    <section class="panel" id="deviceAdderPanel">
      <div class="panelHeader">
        <span class="stepNum">3</span> 機器Noを追加 <span id="targetRoomDisplay" class="highlight">-</span>
      </div>
      
      <!-- 自由入力 -->
      <div class="row" style="margin-bottom:12px;">
        <input type="number" id="manualDeviceNo" placeholder="番号(例:201)" inputmode="numeric" />
        <button id="btnAddManualDevice" class="primary">番号追加</button>
      </div>

      <!-- グリッド (デフォルト閉じ) -->
      <details id="deviceNoPicker">
        <summary class="summaryBtn">定型番号 (001〜199) を開く</summary>
        <div class="hint">※タップすると現在の部屋に機器枠が追加されます</div>
        <div id="devicePad" class="devicePad"></div>
      </details>
    </section>

    <!-- STEP 4: 写真確認 -->
    <section class="panel" style="margin-bottom: 80px;">
      <div class="panelHeader">
        <span class="stepNum">4</span> 写真一覧 <span id="targetDeviceDisplay" class="highlight">-</span>
      </div>
      <div id="photoMeta" class="metaInfo"></div>
      <div id="photoGrid" class="shots"></div>
    </section>

  </main>

  <!-- 下部固定フッター (CTA) -->
  <footer class="footerBar">
    <button id="btnOpenCamera" class="ctaButton" disabled>
      <span class="camIcon">📷</span> 撮影へ
    </button>
  </footer>

  <!-- プレビューモーダル -->
  <div id="preview" class="modal hidden">
    <div class="modalBar">
      <div id="previewTitle" class="modalTitle"></div>
      <div class="modalBtns">
        <button id="zoomReset">等倍</button>
        <button id="closePreview" class="danger">閉じる</button>
      </div>
    </div>
    <div class="modalBody">
      <img id="previewImg" alt="">
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/dexie@4/dist/dexie.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fflate@0.8.2/umd/index.js"></script>

  <script type="module" src="./app.js"></script>
</body>
</html>